# 서브넷마스크 개념정리

기본적으로 우리가 인터넷을 사용하려면 식별자인 IP 주소가 필요합니다. IP 주소는 ipv4 주소체계를 사용하는데 32비트 길이의 식별자로 `0.0.0.0 ~ 255.255.255.255`까지의 숫자의 조합으로 이루어지며 총 네구간으로 나눠져있으며 최대 12자리의 번호로 이루어져 있습니다. IPv4를 통해 최대 약 43억개의 서로 다른 주소를 부여할 수 있습니다.

## IP 클래스 종류

각 IP는 네트워크 ID와 호스트 ID두개로 나뉘어져 있고, 어떻게 나눠졌냐에 따라서 `A~C`클래스로 구분하고 있습니다.

### A 클래스

A 클래스 아이피는 네트워크 ID는 `0~127`로 128개이며
호스트 ID는 `0.0.0부터 255.255.255`까지로 무려 1670만여개에 이릅니다.

> A 클래스 아이피는 통신회사에서 주로 사용합니다. 

### B 클래스

B 클래스 아이피 주소는 첫번째 두번째 자리가 네트워크 ID입니다.

ex) 170.40.122.3

세번째 네번째 자리는 호스트 ID를 의미합니다.

### C 클래스

C 클래스는 첫번재 두번째 세번재 자리가 네트워크 ID입니다. 네번째 자리는 호스트 ID 입니다.

ex) 192.168.0.1

가장 많이 봤던 주소입니다. 공유기가 만들어 내는 사설 IP로 쓰여지고 있습니다.

## 서브넷마스크란? 

서브넷마스크(Subnet Mask)는 기본적으로 네트워크 ID를 표시해줍니다.

위에서 IP 주소의 자리수에 따라서 `A~C`클래스까지 나누어진다고 했지만 사실 이건 절대적인 것이 아니며 네트워크 관리자가 네트워크 ID를 적절하게 조절하면서 사용할 수 있습니다. 

### 서브넷마스크 예시 

먼저, 저의 외부 IP주소를 확인해보았습니다.

현재 Mac OS를 사용하기 때문에 터미널에 아래와 같은 명령어를 입력합니다.

```java
curl ipecho.net/plain; echo

59.12.190.x // 외부 IP 주소
```

서브넷마스크는 `255.255.255.248`으로 설정 되어있습니다.

255는 2진수로 변환하면 `1111 1111`이 됩니다. 2진수 1로 IP주소의 각각의 비트를 OR 논리연산을 하면 무조건 `1`입니다.

따라서 서브넷마스크가 255인 자리가 `네트워크 ID`라고 보면 됩니다.

248은 비트로 표현하면 `1111 1000`이고 0으로 된 부분이 바로 IP를 할당할 수 있는 숫자입니다. 이렇게 되면 할당할 수 있는 IP 주소는 모두 8가지 숫자를 만들 수 있습니다.

ex) 000, 001, 010, 011, 100, 101, 110, 111

즉, 외부 IP 주소는 `59.12.190.x`이고 서브넷마스크가 `255.255.255.248`이라면 59.12.190이라는 네트워크에서 8개의 IP를 만들 수 가 있는데 그 중 한개를 우리집에 주는 것을 의미합니다.

하지만 여기서 의아한점은 `59.12.190.x` IP 주소의 첫번째 자리는 59로 A 클래스에 속하고 네트워크 ID로 보통 쓰입니다. 따라서 서브넷마스크도 `255.0.0.0`으로 써야 되지만 서브넷마스크를 변경해 줌으로써 관리자의 필요대로 호스트 ID 범위를 조절하는 것입니다.

이것을 전문용어로 서브넷팅이라고 합니다.
원래 A클래스는 1670만개의 호스트 ID 주소를 만들수 있지만 서브넷팅으로 단 8개만 만들 수 있습니다.

## 내부 네트워크 설정

이제 내부 IP 주소를 살펴보겠습니다. 내부 IP는 공유기 자체의 아이피 주소입니다. 보통 서브넷 마스크는 `255.255.255.0`으로 되어 있습니다.
 
아래 이미지는 공유기에서 할당받은 내부 IP 주소와 서브넷 마스크를 보여주고 있습니다.

![image](https://user-images.githubusercontent.com/22395934/148404430-c250972e-94a4-4600-b6f6-a207be5bf4e2.png)

서브넷 마스크가 255가 아닌 0로 되어 있는 네번째 자리가 호스트 ID입니다.

내부 IP 주소는 192.로 시작하니까 C 클래스입니다.
그리고 서브넷마스크는 셋째자리까지 마스킹되어 있습니다.
넷째자리가 0이니까 이 공유기가 만들어 낼 수 있는 호스트 아이피 수는 `0~255`인데 0과 255는 사용할 수 없는 호스트 번호이고 1은 라우터, 3은 공유기 아이피니까 2, 4~254번까지의 IP 주소를 만들어 내게 됩니다.

만약 한 집에 방이 3개가 있고 공유기 한대로 방 3개를 연결하려고 하는데 각 방을 구별하기 위해서 ROOM1은 192.168.1.x 대역의 아이피를 할당하고, ROOM2은 192.168.2.x 대역, ROOM3은 192.168.3.x 대역의 아이피를 할당하고자 한다면 그리고 모든 컴퓨터들이나 스마트폰들이 같은 네트워크에 소속되게 하려면 서브넷마스크를 건드리면 됩니다.

서브넷마스크가 `255.255.255.0`으로 되어있다면 세번째 자리의 서브넷마스크를 풀어주면 됩니다. 공유기를 0, ROOM1은 1, ROOM2는 2, ROOM3을 3으로 설정하려면 4개의 숫자가 필요하고 세번째 자리를 `252`로 변경합니다.

252는 비트로 표현하면 `1111 1100`입니다. 총 4자리(00, 01, 10, 11)가 올 수 있습니다. 따라서 각 방들의 모든 단말기들은 단일 네트워크가 되어 서로 공유가 가능하게 됩니다.

> 참고로 공유기는 DHCP 서버가 있어서 내부에서 사설 IP를 만들어 냅니다. 


## 네트워크 범위와 prefix

위의 내용을 토대로 네트워크 주소가 같은 주소를 가진 IP들은 동일한 네트워크 범위에 속하며 이 경우 Router를 통하지 않고 통신이 가능합니다.

네트워크 범위의 첫 번째 주소는 네트워크 자체를 나타내는 주소이고, 마지막 주소는 범위 내에 모든 호스트를 대상을 패킷을 전달하기 위한 `broadcast` 주소를 의미합니다.

따라서 특정 호스트에 이들 주소를 설정해서는 안됩니다.

Prefix 표기란 서브넷 마스크 맨 앞의 비트부터 1의 개수를 표기하는 방식을 말합니다. 즉, 맨 앞에 비트부터 공통 비트 개수를 표기하는 방식입니다.

예를 들어 서브넷 마스크가 255.255.255.0인 경우 맨 앞의 비트부터 1이 24개가 있으므로 /24로 표기합니다.


네트워크 이름은 네트워크 ID의 호스트 부분이 모두 0인 주소를 말합니다. 이 주소는 네트워크를 표기하거나 라우팅 경로로 사용하기 위해 예약된 값이기 때문에 인터페이스 설정이 불가합니다.

예를 들어 `192.168.1.1/24`라는 주소의 네트워크 ID는 `192.168.1`이며 뒤에 8bit는 호스트 아이디입니다.
 
이 때 호스트 ID 전체가 0인 주소, 즉 `192.168.1.0`을 네트워크 이름이라고 합니다.

#### 참조: https://www.youtube.com/watch?v=zS6qqNspqd0
