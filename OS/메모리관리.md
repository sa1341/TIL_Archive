# 메모리 관리

## 메모리 오버레이

메모리 용량보다 큰 프로그램을 실행시키기 위해서 메모리 오버레이 방식으로 처리합니다. 메모리 오버레이란 물리 메모리 용량보다 프로그램 크기가 더 클 경우에는 전체 프로그램을 메모리에 가져오는 대신 적당한 크기로 잘라서 가져오는 기법입니다.

`overlay`는 겹겹이 쌓다 혹은 중첩시키다라는 뜻을 가지고 있습니다. 메모리 오버레이는 하나의 메모리에 여러 프로그램을 겹겹이 쌓고 실행하는 것을 말합니다.

## 메모리 오버레이 사용 예시

대표적으로 아래아 한글이 있는데, 문서 편집기에는 기본 문서 편집 기능 외에 맞춤법 검사, 출력, 그림판 등의 기능이 있습니다. 이러한 기능은 각각 모듈 형태로 분리되어 있다가 프로그램이 실행되면 필요한 모듈만 메모리에 올라와 실행됩니다. 

기본 문서 편집기를 사용하다 그림판이 필요하면 메모리에 그림판을 가져오고, 맞춤법 검사기가 필요하면 그림판을 쫒아내고 그 자리에 맞춤법 검사기를 가져옵니다. 프로그램 전체를 메모리에 올려놓고 실행하는 것보다 속도가 느리지만 메모리가 프로그램보다 작을 때도 실행할 수 있어 유용합니다.

메모리 오버레이에서 어떤 모듈을 가져오거나 내보낼지는 CPU 레지스터 중 하나인 프로그램 카운터가 결정합니다. 프로그램 카운터는 앞으로 실행할 명령어의 위치를 가르키는 레지스터로, 해당 모듈이 메모리에 없으면 메모리 관리자에게 요청하여 메모리로 가져오게 합니다.

결론은 메모리 오버레이는 한정된 메모리에서 메모리보다 큰 프로그램 실행을 가능하게 해주는다는 것이 핀트입니다. 

이것은 가상메모리 시스템의 기본이 되는 개념이기도 합니다.

이렇게 하면 메모리를 여러 조각으로 나누어 여러 프로세스에 할당할 수 있다는 의미기도 합니다.


## 스왑

메모리 오버레이를 사용하여 물리 메모리 공간보다 큰 프로그램을 실행할 수 있었지만, 여기서 생기는 문제는 다른 모듈로 교체하려고 할때 기존의 사용하지 않을 모듈을 어디에 둬야 할지가 문제가 됩니다. 하드디스크 위치에 옮겨놓으면 되겠지만, 다시 사용할 수도 있고 작업이 완료되지 않는 경우도 생길 수 있습니다.

이처럼 메모리가 모자라서 쫒겨난 프로세스는 저장장치의 특별한 공간에 모아두는데 이러한 영역을 `스왑(swap)`이라고 부릅니다. 

스왑영역에서 메모리로 데이터를 가져오는 작업은 `스왑인(swap in)`, 스왑 영역으로 데이터를 내보내는 작업은 `스왑아웃(swap out)`이라고 합니다.

스왑 영역은 메모리 관리자가 관리합니다. 원래 하드디스크와 같은 저장장치는 저장장치 관리자가 관리하지만, 스왑 영역은 메모리에서 쫒겨났다가 다시 돌아가는 데이터가 머무는 곳이기 때문에 저장장치는 장소만 빌려주고 메모리 관리자가 관리하는 것입니다.

메모리 오버레이에서는 메모리보다 큰 프로그램을 실행할 때 메모리보다 작은 크기의 모듈로 나누어서 사용합니다. 여기에 스왑을 이용하면 스왑 영역의 크기를 메모리의 크기로 인식합니다. 다시 말해 사용자는 실제 메모리 크기와 스왑 영역의 크기를 합쳐서 전체 메모리로 인식하고 사용할 수 있습니다


### 스왑인과 스왑아웃 이미지 

![스왑인과스왑아웃](https://user-images.githubusercontent.com/22395934/126871361-b1ee774b-c3dc-4e62-bc8b-034fa53e0c8d.png)

만약 실제 메모리 크기가 1GB, 스왑의 크기가 3GB라면 사용자가 인식하는 메모리는 4GB 입니다. 이는 실제 메모리가 4GB인 컴퓨터보다 속도가 느리겠지만, 스왑을 사용하면 실제 메모리의 모자란 부분을 보충할 수 있습니다. 사용자 입장에서는 실제 메모리 크기에 상관없이 큰 프로그램을 실행할 수 있는 것입니다.

실제 스왑을 사용하는 부분은 우리에게 익숙한 윈도우의 최대 절전 모드 기능입니다. 최대 절전 모드를 사용하면 CPU와 메모리의 전력 공급을 끊기 때문에 메모리에 있는 내용이 모두 사라집니다. 그러므로 원래의 작업으로 복귀시키려면 현재 메모리에 있는 데이터를 어딘가에 옮겨야 하는데 이 때 옮겨가는 곳이 스왑 영역입니다.


