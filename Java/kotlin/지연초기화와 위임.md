# 지연초기화와 위임

기본적으로 프로퍼티를 선언하면 모두 초기화해야 합니다. 하지만 객체의 정보가 나중에 나타나는 경우 객체 생성과 동시에 초기화하기 힘든 경우가 있습니다. 이럴 때 지연초기화를 사용합니다.

보통 클래스에서는 기본적으로 선언하는 프로퍼티 자료형들은 null을 가질 수 없기 때문에 생성자에서 초기화하거나 매개변수로 값을 초기화해야 하는 것이 규칙입니다.

## lateinit을 사용한 지연 초기화

기본 자료형들은 생성자에서 반드시 초기화되어야 하지만 의존성이 있는 초기화나 유닛 테스트를 위한 코드를 작성하면서 설정에 의한 초기화를 할 때는 매번 초기화하기 불편합니다.

예를들어 Car 클래스의 초기화 부분이 Engine 클래스와 의존성을 가질 때 Engine 객체가 생성되지 않으면 완전하게 초기화할 수 없습니다. 이처럼 특정 객체의 의존성이 있는 경우에는 지연초기화를 해야 합니다.

또 해당 자료형의 프로퍼티를 즉시 사용하지 않는데도 미리 생성해서 초기화한다면 메모리가 사용되어 낭비될 수도 있죠. 모듈별로 소스 코드를 테스트하는 유닛 테스트를 할 때는 임시적으로 객체를 생성시켜야 하는 경우가 많습니다. 이때도 지연 초기화를 사용해야 합니다.

## 프로퍼티 지연 초기화하기

먼저 프로퍼티를 지연 초기화하는 방법을 살펴보겠습니다. 클래스를 선언할 때 프로퍼티 선언은 null을 허용하지 않습니다. 하지만 지연 초기화를 위한 lateinit 키워드를 사용하면 프로퍼티에 값이 바로 할당되지 않아도 컴파일러에서 허용하게 됩니다.

컴파일러에게 나중에 할당한다고 알려주는 것입니다. 단 실행할 때까지 값이 비어있는 상태라면 오류를 유발할 수 있습니다.

### lateinit 블록을 사용한 초기화

lateinit은 var로 선언된 프로퍼티에만 사용할 수 있다는 제한이 있습니다. 또 프로퍼티에 대한 게터와 세터를 사용할 수 없습니다.

lateinit의 제한
- getter, setter를 사용할 수 없습니다
- var로 선언된 프로퍼티만 가능합니다.

## lateinit 코드 예제

```kotlin
class Person {
    lateinit var name: String

    fun test() {

        if (!::name.isInitialized) {
            println("not initialized")
        } else {
            println("initialized")
        }
    }
}

fun main(args: Array<String>) {
    val jean = Person()
    jean.test()
    jean.name = "junyoung"
    jean.test()
    println("name = ${jean.name}")
}
```

위 코드를 보면 Person 클래스의 name 프로퍼티를 lateinit으로 선언했습니다. 그러면 name 프로퍼티는 초기화하지 않은 채 선언할 수 있습니다. 즉, main() 함수의 블록에서 val jean = Person()으로 객체를 생성해도 name은 초기화되지 않습니다. 

> isInitialized은 코틀린 표준 함수의 API 입니다.
프로퍼티 참조를 위해 콜론(::)을 사용했습니다. isInitialized가 true를 반환하면 프로퍼티가 할당되었다는 뜻이며 false를 반환하면 할당되지 않았다는 뜻입니다. 

`jean.name = junyoung`과 같이 값이 할당되면 이때 name이 초기화됩니다. 생성시점이 아닌 특정 본문 내에서 name을 늦게 초기화할 수 있습니다.

만약에 값을 할당하지 않고 사용하면 아래와 같은 에러를 만나니 조심해야합니다.

```kotlin
kotlin.UninitializedPropertyAccessException: lateinit property name has not been initialized
```

## 객체 지연 초기화하기

생성자를 통해 객체를 생성할 때도 lateinit을 사용해 필요한 시점에 객체를 지연 초기화할 수 있습니다. 다음 소스 코드를 살펴봅시다.

```kotlin
data class Person(var name: String, var age: Int)

lateinit var person: Person

fun main(args: Array<String>) {
    person = Person("jean", 30)
    print(person.name + " is " + person.age.toString())
}
```

main() 함수 밖의 person 객체는 생성자를 통해 선언되지 않았습니다. 하지만 lateinit에 의해서 지연 초기화를 할 수 있기 때문에 오류를 발생하지 않습니다. 실제로 person의 초기화는 main() 함수 블록 본문에서 생성자를 통해 지연 초기화를 하고 있습니다.
