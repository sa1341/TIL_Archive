# 서브쿼리 종류

서브쿼리란 하나의 SQL 문에 포함되어 있는 또 다른 SQL 문을 말합니다.

## 1. 서브쿼리 사용 시 주의사항

1. 서브쿼리를 괄호로 감싸서 사용합니다.
2. 서브쿼리는 단일 행 또는 복수 행 비교 연산자와 함께 사용 가능합니다.
3. 서브쿼리에서는 ORDER BY를 사용하지 못합니다.

## 2. 서브쿼리가 사용 가능 한곳


- SELECT 절
- FROM 절
- WHERE 절
- HAVING 절
- ORDER BY 절
- INSERT 문의 VALUES 절
- UPDATE 문의 SET 절

SELECT 절과 FROM 절에서 사용하는 서브쿼리는 아래와 같은 명칭을 가집니다.

### 스칼라 서브쿼리: SELECT 절에서 사용하는 서브쿼리

스칼라 서브쿼리는 한 행, 한 컬럼만을 반환하는 서브쿼리를 말합니다.

```java
SELECT T1.C1, (SELECT AVG(T2.C1) FROM T2 T2)
FROM T1 T1;
```

### 인라인 뷰: FROM 절에서 사용하는 서브 쿼리

기본적으로 FROM 절에는 테이블 명이 오도록 되어있습니다. 그런데 서브쿼리가 FROM 절에 사용되면 동적으로 생성된 테이블인 것처럼 사용할 수 있습니다.

인라인 뷰는 SQL문이 실행될 때만 임시적으로 생성되는 동적인 뷰이기 때문에 데이터베이스에 해당 정보가 저장되지 않습니다. 인라인 뷰는 동적으로 조인 방식을 사용하는 것과 같습니다.

```java
SELECT T1.C1, T2.C1, T2.C2
FROM T1 T1,
     (SELECT C1, C2 FROM T2) T2
WHERE T1.C1 = T2.C1;
```


서브쿼리는 단일 행 비교 연산자 (`=, <, <=, >, >=, <>`)와 함께 사용할 때는 서브쿼리의 결과 건수가 반드시 1건 이하여야 합니다. 만약 결과가 2건 이상인 경우 오류가 발생합니다.

 아래는 단일 행 쿼리 예제입니다.
 만약 T2 테이블의 C2 = 3 인 조건을 만족하는 C1의 값이 2건 이상인 경우 오류가 발생합니다.

```sql
SELECT C1, C2, C3
FROM T1
WHERE C1 = (SELECT C1
            FROM T2
            WHERE C2 = '3')
ORDER BY C1, C2, C3;
```

그룹 함수를 사용하는 경우 결과값이 1건이기 때문에 단일행 서브쿼리로써 사용 가능 합니다.

```sql
SELECT C1, C2, C3
FROM T1
WHERE C1 <= (SELECT AVG(C1)
            FROM T2
            WHERE C2 = '3')
ORDER BY C1, C2, C3; 
```

#### 참조 블로그: https://mozi.tistory.com/233
